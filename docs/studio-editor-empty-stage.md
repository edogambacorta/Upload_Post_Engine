# Studio Editor Empty Stage Investigation

## Context
Opening `http://localhost:5173/studio/editor?runId=<some-run>` should hydrate the editor with the posts generated by that run. Instead, the entire center stage stays blank and none of the preview/editor tooling becomes interactive.

## Instrumentation Notes
- `src/web/components/studio/Editor/StudioEditor.tsx` now logs a state snapshot any time the page renders, including the `runId` query parameter, total slides in the store, and the currently selected slide. A warning is emitted when a `runId` is present but the store is empty.
- `src/web/components/studio/Editor/PreviewPanel.tsx` logs its lifecycle: when the Fabric canvas is instantiated/disposed, when slide rendering kicks off, and when it cannot render because there is no canvas or no slides. This gave us visibility without stepping into the Fabric debugger.

These logs quickly showed that the editor can render successfully in general, but on a direct deep link it never receives any slides to render.

## Root Cause
- `Dashboard.openRun` (`src/web/components/studio/Dashboard.tsx`) contains the **only** logic that fetches a run (`GET http://localhost:3000/api/runs/:runId`), normalizes run posts to slides, and dispatches them into the studio store before navigating to `/studio/editor?runId=...`.
- `StudioEditor` itself never reads the `runId` query parameter, never fetches backend data, and never populates the store on mount. Because the store is initialized empty in `StudioProvider`, loading `/studio/editor?runId=...` directly means `slides.length === 0` and `selectedSlideId === null` forever.
- Before adding logging the `PreviewPanel` also crashed immediately because it referenced `selectedSlide` and `previewRef` without ever defining them or instantiating a Fabric canvas. That ReferenceError prevented any fallback UI from appearing, so the center pane was just empty.

So the “nothing loads” behavior stems from two problems: the preview component threw before it could render its “Generate a draft…” fallback, and there is no hydration logic tied to the `runId` query param.

## Proposed Fix
1. Inside `StudioEditor`, read the `runId` query param with `useSearchParams`. When it exists and the store has zero slides:
    - Fetch `GET /api/runs/:runId`.
    - Map the posts to the `Slide` model (same logic already living in `Dashboard.openRun`).
    - Dispatch `SET_TOPIC`, `SET_AUDIENCE`, `SET_SLIDES`, and `SET_SELECTED_SLIDE` so the editor has data to render.
    - Consider caching the last loaded run id in the store to avoid redundant fetches when navigating between tabs.
2. Keep the new defensive guards in `PreviewPanel` so the center stage shows the placeholder panel (with logs) whenever the store is empty instead of crashing silently.
3. (Optional UX) Surface an inline error state when a `runId` is provided but the fetch fails, prompting the user to go back to the dashboard.

Implementing the `runId` hydration flow will let deep links open a saved run directly, and the additional logging will keep future regressions easy to diagnose.

## Fix Implementation
- Added `src/web/lib/studio/runLoader.ts` with helpers that call `GET /api/runs/:id`, normalize run posts into `Slide` objects, and determine the proper `PostType`.
- Updated `StudioEditor` to:
  - Watch the `runId` query param and fetch/hydrate the store whenever it exists and the store is empty.
  - Dispatch topic/audience/mode/slide state updates plus select the first slide automatically.
  - Surface inline loading + error banners so the user understands why the editor is blank if the fetch fails.
- The existing PreviewPanel guards remain, so any failure to load slides now shows the placeholder UI instead of a silent crash.
- Added `Access-Control-Allow-Origin` headers on the `/runs` static assets so the Fabric canvas can safely load generated images when the web UI runs on the Vite dev server (`5173`) and the API serves assets from `3000`.
